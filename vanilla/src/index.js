(()=>{function e(e,t){for(const o in d.grupos)if(o!==t&&e!==d.grupos[o]&&a(e,d.grupos[o]))return[!1,o];return[!0,null]}function t(t){const s=document.getElementById("materias");s.innerHTML="",t.forEach((t=>{const a=document.createElement("tr");a.innerHTML=`\n            <td class="border px-2 text-center">${t.codigo}</td>\n            <td class="border px-2 text-center">${t.creditos}</td>\n            <td class="border px-2">${t.nombre}</td>\n            <td class="border px-2"><button class="btn btn-outline-success my-button">+</button></td>\n            <td class="border px-2 text-center">${t.tipologia}</td>\n            <td class="border px-2 text-center">${t.grupos.length}</td>\n        `;const i=a.querySelector("button");i.addEventListener("click",(()=>{!function(e){const t=document.getElementById("popUp");t.querySelector("#popUp-body").textContent=`Se agrego: ${e.nombre}.`,bootstrap.Toast.getOrCreateInstance(t).show()}(t),function(t,s){const a=document.getElementById("selected"),i=document.createElement("tr");i.innerHTML=`\n        <td id="codigo" class="px-3 border">${t.codigo}</td>\n        <td id="nombre" class="px-3 border">${t.nombre}</td>\n        <td class="px-3 border text-center">${t.creditos}</td>\n        <td class="px-3 border text-center"><select class="form-select form-select-sm"></select></td>\n        <td id="docente" class="px-3 border text-center"></td>\n        <td id="cupos" class="px-3 border text-center"></td>\n        <td id="horario" class="px-3 border text-center"></td>\n        <td class="px-3 border text-center"><button class="btn btn-outline-danger my-button"><i class="bi bi-trash"></i></button></td>\n    `;const l=i.querySelector("select");(()=>{const e=document.createElement("option");e.text="No seleccionado",e.value="",l.appendChild(e)})(),t.grupos.forEach((e=>{const t=document.createElement("option");t.text=e.grupo,t.value=e.grupo,t.selected=!1,l.appendChild(t)}));const u=e=>{e&&(e.forEach((e=>{e.classList.remove(p),e.textContent=""})),o.usedColors=o.usedColors.filter((e=>e!==p)))},p=c();i.classList.add(`tr-${p}`);let m=null;d.materias[t.codigo]=t,l.addEventListener("change",(function(){if(""===this.value)u(m),delete d.grupos[t.codigo];else{const e=t.grupos.find((e=>e.grupo===this.value));!function(e,t){e.querySelector("#docente").textContent=t.profesor,e.querySelector("#cupos").textContent=t.cupos,e.querySelector("#horario").textContent=t.horarios.map((e=>`${e.dia} ${e.inicio}-${e.fin}`)).join(", ")}(i,e),d.grupos[t.codigo]=e,u(m),m=function(e,t,o){const c=e.horarios,s=[];for(const e of c){const[c,d,a]=r(e);for(let e=c;e<d;e++){const r=n(e,a);r.classList.add(o),r.textContent=t.nombre,s.push(r)}}return s}(e,t,p)}!function(t){const o=document.getElementById("selected").querySelectorAll("tr");for(const n of o)if(n!==t){const t=n.querySelector("select"),o=d.materias[n.querySelector("#codigo").textContent],r=t.querySelectorAll("option");for(const t of r){if(""===t.value)continue;const n=o.grupos.find((e=>e.grupo===t.value)),[r,c]=e(n,o.codigo);t.title=r?"":`Se cruza con ${d.materias[c].nombre}`,t.disabled=!r}}}(i)}));i.querySelector("button").addEventListener("click",(()=>{i.remove(),delete d.materias[t.codigo],d.grupos.hasOwnProperty(t.codigo)&&delete d.grupos[t.codigo],u(m),s.disabled=!1,s.className="btn btn-outline-success my-button"})),a.appendChild(i)}(t,i),i.disabled=!0,i.className="btn btn-outline-secondary my-button"})),s.appendChild(a)}))}(async()=>{const e=await fetch("assets/data.json"),o=await e.json(),n=Object.keys(o),r=document.getElementById("facultad"),c=document.getElementById("carrera"),d=document.getElementById("tipologia");s(r,n),r.addEventListener("change",(function(){const e=this.value,t=Object.keys(o[e]);s(c,t)})),c.addEventListener("change",(function(){const e=r.value,t=this.value,n=o[e][t],c=["TODAS LAS ASIGNATURAS",...new Set(n.map((e=>e.tipologia)))];s(d,c),d.dispatchEvent(new Event("change"))})),d.addEventListener("change",(function(){t(function(e,t,n){const r=o[e][t];return"TODAS LAS ASIGNATURAS"===n?r:r.filter((e=>e.tipologia===n))}(r.value,c.value,this.value))})),r.dispatchEvent(new Event("change"))})();const o={usedColors:[]};function n(e,t){return document.getElementById("calendar-body").querySelector(`#hora-${e}`).querySelector(`#${t}`)}function r(e){return[parseInt(e.inicio.split(":")[0]),parseInt(e.fin.split(":")[0]),e.dia.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"")]}function c(){const e=`color-${Math.floor(11*Math.random())+1}`;return o.usedColors.includes(e)&&o.usedColors.length<11?c():(o.usedColors.push(e),e)}function s(e,t){e.innerHTML="",t.forEach((t=>{const o=document.createElement("option");o.text=t,o.value=t,e.appendChild(o)}))}document.getElementById("calendar-body");const d={materias:{},grupos:{}};function a(e,t){const o=e.horarios,n=t.horarios;for(const e of o){const[t,o,c]=r(e);for(const e of n){const[n,s,d]=r(e);if(c===d&&(t==n&&o==s||t<s&&o>n||n<o&&s>t))return!0}}return!1}})();